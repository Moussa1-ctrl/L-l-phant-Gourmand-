<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'ELEPHANT GROUMANT - Comptabilité</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #6a0dad, #ff8c00);
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }
        
        h1, h2 {
            color: #6a0dad;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 5px;
        }
        
        .subtitle {
            text-align: center;
            color: #ff8c00;
            margin-top: 0;
            margin-bottom: 30px;
            font-weight: bold;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 10px;
            border-left: 5px solid #6a0dad;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #6a0dad;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #6a0dad;
        }
        
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        button {
            background-color: #ff8c00;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #e67e00;
        }
        
        .button-group {
            margin-top: 20px;
            text-align: center;
        }
        
        .invoice {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            width: 80%;
            margin: 0 auto;
        }
        
        .invoice-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #6a0dad;
            padding-bottom: 10px;
        }
        
        .invoice-item {
            margin-bottom: 10px;
        }
        
        .total {
            font-weight: bold;
            font-size: 1.2em;
            text-align: right;
            margin-top: 20px;
            border-top: 2px solid #ff8c00;
            padding-top: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background-color: #ddd;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: #6a0dad;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            color: #777;
            font-size: 0.9em;
        }
        
        /* Styles spécifiques pour l'impression */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-section, .print-section * {
                visibility: visible;
            }
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background-color: white;
                padding: 20px;
                box-shadow: none;
            }
            .no-print {
                display: none !important;
            }
            .invoice {
                width: 100%;
                box-shadow: none;
            }
        }
        
        .row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .col {
            flex: 1;
        }
        
        .comptability-print {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>L'ELEPHANT GROUMANT</h1>
        <p class="subtitle">Application Comptable</p>
        
        <div class="tabs no-print">
            <div class="tab active" onclick="openTab('vente')">Vente</div>
            <div class="tab" onclick="openTab('achat')">Achat</div>
            <div class="tab" onclick="openTab('comptabilite')">Comptabilité</div>
        </div>
        
        <!-- SECTION VENTE -->
        <div id="vente" class="tab-content active">
            <div class="section">
                <h2>Nouvelle Vente</h2>
                <div id="items-container">
                    <div class="form-group item-row">
                        <div class="row">
                            <div class="col">
                                <label for="boisson1">Boisson</label>
                                <select id="boisson1" class="boisson-select" onchange="updatePrice(this)">
                                    <option value="">Sélectionner une boisson</option>
                                    <option value="Eau">Eau (500€)</option>
                                    <option value="Soda">Soda (700€)</option>
                                    <option value="Jus">Jus (600€)</option>
                                    <option value="Biere">Biere (800€)</option>
                                    <option value="Vin">Vin (1200€)</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="quantite1">Quantité</label>
                                <input type="number" id="quantite1" class="quantite-input" min="1" value="1" onchange="calculateRow(this)">
                            </div>
                            <div class="col">
                                <label for="prix1">Prix unitaire (FCFA)</label>
                                <input type="number" id="prix1" class="prix-input" readonly>
                            </div>
                            <div class="col">
                                <label for="montant1">Montant (FCFA)</label>
                                <input type="number" id="montant1" class="montant-input" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button onclick="addItem()">Ajouter un article</button>
                <button onclick="removeItem()">Supprimer le dernier article</button>
                
                <div class="button-group">
                    <button onclick="generateInvoice()">Générer la facture</button>
                    <button onclick="saveTransaction()">Enregistrer la transaction</button>
                </div>
            </div>
            
            <div id="invoice-section" class="section" style="display: none;">
                <h2>Facture Client</h2>
                <div class="invoice print-section" id="invoice">
                    <div class="invoice-header">
                        <h3>L'ELEPHANT GROUMANT</h3>
                        <p>Vente de boissons</p>
                        <p>BP: 12345 - Tél: 00 00 00 00</p>
                        <p id="invoice-date"></p>
                        <p>Facture N°: <span id="invoice-number"></span></p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Désignation</th>
                                <th>Qté</th>
                                <th>P.U</th>
                                <th>Montant</th>
                            </tr>
                        </thead>
                        <tbody id="invoice-items">
                            <!-- Les éléments de la facture seront ajoutés ici -->
                        </tbody>
                    </table>
                    <div class="total" id="invoice-total">
                        Total: 0 FCFA
                    </div>
                    <div style="text-align: center; margin-top: 30px;">
                        <p>Merci pour votre visite !</p>
                        <p>Client satisfait = Notre priorité</p>
                    </div>
                </div>
                
                <div class="button-group no-print">
                    <button onclick="printInvoice()">Imprimer la facture</button>
                    <button onclick="saveAsPDF()">Enregistrer en PDF</button>
                </div>
            </div>
        </div>
        
        <!-- SECTION ACHAT -->
        <div id="achat" class="tab-content">
            <div class="section">
                <h2>Nouvel Achat</h2>
                <div id="achat-items-container">
                    <div class="form-group item-row">
                        <div class="row">
                            <div class="col">
                                <label for="achat-boisson1">Boisson</label>
                                <select id="achat-boisson1" class="achat-boisson-select">
                                    <option value="">Sélectionner une boisson</option>
                                    <option value="Eau">Eau</option>
                                    <option value="Soda">Soda</option>
                                    <option value="Jus">Jus</option>
                                    <option value="Biere">Biere</option>
                                    <option value="Vin">Vin</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="achat-quantite1">Quantité</label>
                                <input type="number" id="achat-quantite1" class="achat-quantite-input" min="1" value="1" onchange="calculateAchatRow(this)">
                            </div>
                            <div class="col">
                                <label for="achat-prix1">Prix unitaire (FCFA)</label>
                                <input type="number" id="achat-prix1" class="achat-prix-input" min="1" onchange="calculateAchatRow(this)">
                            </div>
                            <div class="col">
                                <label for="achat-montant1">Montant (FCFA)</label>
                                <input type="number" id="achat-montant1" class="achat-montant-input" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button onclick="addAchatItem()">Ajouter un article</button>
                <button onclick="removeAchatItem()">Supprimer le dernier article</button>
                
                <div class="form-group">
                    <label for="fournisseur">Fournisseur</label>
                    <input type="text" id="fournisseur" placeholder="Nom du fournisseur">
                </div>
                
                <div class="button-group">
                    <button onclick="saveAchat()">Enregistrer l'achat</button>
                </div>
            </div>
            
            <div class="section">
                <h2>Bon de Commande</h2>
                <div class="invoice print-section" id="bon-commande" style="display: none;">
                    <div class="invoice-header">
                        <h3>L'ELEPHANT GROUMANT</h3>
                        <p>Bon de commande</p>
                        <p id="commande-date"></p>
                        <p>Fournisseur: <span id="commande-fournisseur"></span></p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Désignation</th>
                                <th>Qté</th>
                                <th>P.U</th>
                                <th>Montant</th>
                            </tr>
                        </thead>
                        <tbody id="commande-items">
                            <!-- Les éléments de la commande seront ajoutés ici -->
                        </tbody>
                    </table>
                    <div class="total" id="commande-total">
                        Total: 0 FCFA
                    </div>
                    <div style="text-align: right; margin-top: 30px;">
                        <p>Signature</p>
                        <p>_________________________</p>
                    </div>
                </div>
                
                <div class="button-group no-print">
                    <button onclick="printCommande()">Imprimer le bon</button>
                    <button onclick="saveCommandeAsPDF()">Enregistrer en PDF</button>
                </div>
            </div>
        </div>
        
        <!-- SECTION COMPTABILITE -->
        <div id="comptabilite" class="tab-content">
            <div class="section">
                <h2>Comptabilité</h2>
                
                <div class="tabs no-print">
                    <div class="tab active" onclick="openComptabilityTab('achats')">Achats</div>
                    <div class="tab" onclick="openComptabilityTab('ventes')">Ventes</div>
                    <div class="tab" onclick="openComptabilityTab('stock')">Stock</div>
                    <div class="tab" onclick="openComptabilityTab('recette')">Recette</div>
                </div>
                
                <div id="achats" class="tab-content active">
                    <h3>Journal des Achats</h3>
                    <div class="no-print">
                        <button onclick="printComptability('achats')">Imprimer</button>
                        <button onclick="exportComptability('achats')">Exporter</button>
                    </div>
                    <table id="achats-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Fournisseur</th>
                                <th>Boisson</th>
                                <th>Qté</th>
                                <th>P.U</th>
                                <th>Montant</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Les achats seront ajoutés ici -->
                        </tbody>
                        <tfoot id="achats-total">
                            <tr>
                                <th colspan="5">Total</th>
                                <th>0 FCFA</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div id="ventes" class="tab-content">
                    <h3>Journal des Ventes</h3>
                    <div class="no-print">
                        <button onclick="printComptability('ventes')">Imprimer</button>
                        <button onclick="exportComptability('ventes')">Exporter</button>
                    </div>
                    <table id="ventes-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Boisson</th>
                                <th>Qté</th>
                                <th>P.U</th>
                                <th>Montant</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Les ventes seront ajoutés ici -->
                        </tbody>
                        <tfoot id="ventes-total">
                            <tr>
                                <th colspan="4">Total</th>
                                <th>0 FCFA</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div id="stock" class="tab-content">
                    <h3>État du Stock</h3>
                    <div class="no-print">
                        <button onclick="printComptability('stock')">Imprimer</button>
                        <button onclick="exportComptability('stock')">Exporter</button>
                    </div>
                    <table id="stock-table">
                        <thead>
                            <tr>
                                <th>Boisson</th>
                                <th>Qté achetée</th>
                                <th>Qté vendue</th>
                                <th>Stock restant</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Le stock sera calculé ici -->
                        </tbody>
                    </table>
                </div>
                
                <div id="recette" class="tab-content">
                    <h3>Recette</h3>
                    <div class="no-print" style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <div>
                            <button onclick="printComptability('recette')">Imprimer</button>
                            <button onclick="exportComptability('recette')">Exporter</button>
                        </div>
                        <div>
                            <label for="month-select">Mois:</label>
                            <select id="month-select" onchange="updateRevenue()">
                                <option value="1">Janvier</option>
                                <option value="2">Février</option>
                                <option value="3">Mars</option>
                                <option value="4">Avril</option>
                                <option value="5">Mai</option>
                                <option value="6">Juin</option>
                                <option value="7">Juillet</option>
                                <option value="8">Août</option>
                                <option value="9">Septembre</option>
                                <option value="10">Octobre</option>
                                <option value="11">Novembre</option>
                                <option value="12">Décembre</option>
                            </select>
                            <label for="year-select">Année:</label>
                            <select id="year-select" onchange="updateRevenue()">
                                <option value="2023">2023</option>
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                    </div>
                    
                    <table id="recette-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Ventes</th>
                                <th>Achats</th>
                                <th>Bénéfice</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- La recette sera calculée ici -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <th>Total mensuel</th>
                                <th id="monthly-sales">0 FCFA</th>
                                <th id="monthly-purchases">0 FCFA</th>
                                <th id="monthly-revenue">0 FCFA</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="footer no-print">
            Application Comptable - L'ELEPHANT GROUMANT © 2025
        </div>
    </div>

    <!-- Section cachée pour l'impression de la comptabilité -->
    <div id="comptability-print" class="comptability-print print-section">
        <h2 id="print-comptability-title"></h2>
        <div id="print-comptability-content"></div>
        <div class="footer">
            Document généré le <span id="print-date"></span> à <span id="print-time"></span>
        </div>
    </div>

    <script>
        // Données initiales
        const boissons = {
            'Eau': { prixAchat: 300, prixVente: 500 },
            'Soda': { prixAchat: 500, prixVente: 700 },
            'Jus': { prixAchat: 400, prixVente: 600 },
            'Biere': { prixAchat: 600, prixVente: 800 },
            'Vin': { prixAchat: 900, prixVente: 1200 }
        };
        
        let achats = [];
        let ventes = [];
        let currentItems = 1;
        let currentAchatItems = 1;
        let invoiceCounter = 1;
        
        // Fonctions pour la gestion des onglets
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        function openComptabilityTab(tabName) {
            const tabs = document.querySelectorAll('#comptabilite .tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const tabButtons = document.querySelectorAll('#comptabilite .tab');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
            
            if (tabName === 'stock') {
                updateStock();
            } else if (tabName === 'recette') {
                updateRevenue();
            }
        }
        
        // Fonctions pour la gestion des ventes
        function addItem() {
            currentItems++;
            const container = document.getElementById('items-container');
            const newItem = document.createElement('div');
            newItem.className = 'form-group item-row';
            newItem.innerHTML = `
                <div class="row">
                    <div class="col">
                        <label for="boisson${currentItems}">Boisson</label>
                        <select id="boisson${currentItems}" class="boisson-select" onchange="updatePrice(this)">
                            <option value="">Sélectionner une boisson</option>
                            <option value="Eau">Eau (500€)</option>
                            <option value="Soda">Soda (700€)</option>
                            <option value="Jus">Jus (600€)</option>
                            <option value="Biere">Biere (800€)</option>
                            <option value="Vin">Vin (1200€)</option>
                        </select>
                    </div>
                    <div class="col">
                        <label for="quantite${currentItems}">Quantité</label>
                        <input type="number" id="quantite${currentItems}" class="quantite-input" min="1" value="1" onchange="calculateRow(this)">
                    </div>
                    <div class="col">
                        <label for="prix${currentItems}">Prix unitaire (FCFA)</label>
                        <input type="number" id="prix${currentItems}" class="prix-input" readonly>
                    </div>
                    <div class="col">
                        <label for="montant${currentItems}">Montant (FCFA)</label>
                        <input type="number" id="montant${currentItems}" class="montant-input" readonly>
                    </div>
                </div>
            `;
            container.appendChild(newItem);
        }
        
        function removeItem() {
            if (currentItems > 1) {
                const container = document.getElementById('items-container');
                container.removeChild(container.lastChild);
                currentItems--;
            }
        }
        
        function updatePrice(selectElement) {
            const id = selectElement.id.replace('boisson', '');
            const boisson = selectElement.value;
            if (boisson && boissons[boisson]) {
                document.getElementById(`prix${id}`).value = boissons[boisson].prixVente;
                calculateRow(selectElement);
            } else {
                document.getElementById(`prix${id}`).value = '';
                document.getElementById(`montant${id}`).value = '';
            }
        }
        
        function calculateRow(inputElement) {
            const id = inputElement.id.replace('quantite', '');
            const quantite = parseInt(inputElement.value) || 0;
            const prix = parseInt(document.getElementById(`prix${id}`).value) || 0;
            const montant = quantite * prix;
            document.getElementById(`montant${id}`).value = montant;
        }
        
        function generateInvoice() {
            const invoiceItems = document.getElementById('invoice-items');
            invoiceItems.innerHTML = '';
            let total = 0;
            let hasItems = false;
            
            for (let i = 1; i <= currentItems; i++) {
                const boisson = document.getElementById(`boisson${i}`).value;
                const quantite = document.getElementById(`quantite${i}`).value;
                const prix = document.getElementById(`prix${i}`).value;
                const montant = document.getElementById(`montant${i}`).value;
                
                if (boisson && quantite > 0) {
                    hasItems = true;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${boisson}</td>
                        <td>${quantite}</td>
                        <td>${prix} FCFA</td>
                        <td>${montant} FCFA</td>
                    `;
                    invoiceItems.appendChild(row);
                    total += parseInt(montant);
                }
            }
            
            if (!hasItems) {
                alert("Veuillez ajouter au moins un article à la facture");
                return;
            }
            
            document.getElementById('invoice-total').textContent = `Total: ${total} FCFA`;
            
            const now = new Date();
            document.getElementById('invoice-date').textContent = `Date: ${formatDate(now)}`;
            document.getElementById('invoice-number').textContent = `FAC-${now.getFullYear()}${String(now.getMonth()+1).padStart(2, '0')}${String(invoiceCounter).padStart(4, '0')}`;
            
            document.getElementById('invoice-section').style.display = 'block';
        }
        
        function saveTransaction() {
            const invoiceItems = document.getElementById('invoice-items');
            if (invoiceItems.children.length === 0) {
                alert("Veuillez générer la facture avant d'enregistrer");
                return;
            }
            
            const now = new Date();
            const dateStr = formatDate(now);
            
            for (let i = 1; i <= currentItems; i++) {
                const boisson = document.getElementById(`boisson${i}`).value;
                const quantite = parseInt(document.getElementById(`quantite${i}`).value) || 0;
                const prix = parseInt(document.getElementById(`prix${i}`).value) || 0;
                const montant = parseInt(document.getElementById(`montant${i}`).value) || 0;
                
                if (boisson && quantite > 0) {
                    ventes.push({
                        date: dateStr,
                        boisson: boisson,
                        quantite: quantite,
                        prix: prix,
                        montant: montant
                    });
                }
            }
            
            invoiceCounter++;
            updateVentesTable();
            alert('Transaction enregistrée avec succès!');
            
            // Réinitialiser le formulaire de vente
            for (let i = 1; i <= currentItems; i++) {
                document.getElementById(`boisson${i}`).value = '';
                document.getElementById(`quantite${i}`).value = '1';
                document.getElementById(`prix${i}`).value = '';
                document.getElementById(`montant${i}`).value = '';
            }
            document.getElementById('invoice-section').style.display = 'none';
        }
        
        // Fonctions pour la gestion des achats
        function addAchatItem() {
            currentAchatItems++;
            const container = document.getElementById('achat-items-container');
            const newItem = document.createElement('div');
            newItem.className = 'form-group item-row';
            newItem.innerHTML = `
                <div class="row">
                    <div class="col">
                        <label for="achat-boisson${currentAchatItems}">Boisson</label>
                        <select id="achat-boisson${currentAchatItems}" class="achat-boisson-select">
                            <option value="">Sélectionner une boisson</option>
                            <option value="Eau">Eau</option>
                            <option value="Soda">Soda</option>
                            <option value="Jus">Jus</option>
                            <option value="Biere">Biere</option>
                            <option value="Vin">Vin</option>
                        </select>
                    </div>
                    <div class="col">
                        <label for="achat-quantite${currentAchatItems}">Quantité</label>
                        <input type="number" id="achat-quantite${currentAchatItems}" class="achat-quantite-input" min="1" value="1" onchange="calculateAchatRow(this)">
                    </div>
                    <div class="col">
                        <label for="achat-prix${currentAchatItems}">Prix unitaire (FCFA)</label>
                        <input type="number" id="achat-prix${currentAchatItems}" class="achat-prix-input" min="1" onchange="calculateAchatRow(this)">
                    </div>
                    <div class="col">
                        <label for="achat-montant${currentAchatItems}">Montant (FCFA)</label>
                        <input type="number" id="achat-montant${currentAchatItems}" class="achat-montant-input" readonly>
                    </div>
                </div>
            `;
            container.appendChild(newItem);
        }
        
        function removeAchatItem() {
            if (currentAchatItems > 1) {
                const container = document.getElementById('achat-items-container');
                container.removeChild(container.lastChild);
                currentAchatItems--;
            }
        }
        
        function calculateAchatRow(inputElement) {
            const id = inputElement.id.replace('achat-quantite', '').replace('achat-prix', '');
            const quantite = parseInt(document.getElementById(`achat-quantite${id}`).value) || 0;
            const prix = parseInt(document.getElementById(`achat-prix${id}`).value) || 0;
            const montant = quantite * prix;
            document.getElementById(`achat-montant${id}`).value = montant;
        }
        
        function saveAchat() {
            const fournisseur = document.getElementById('fournisseur').value;
            if (!fournisseur) {
                alert("Veuillez entrer le nom du fournisseur");
                return;
            }
            
            let hasItems = false;
            const now = new Date();
            const dateStr = formatDate(now);
            
            for (let i = 1; i <= currentAchatItems; i++) {
                const boisson = document.getElementById(`achat-boisson${i}`).value;
                const quantite = parseInt(document.getElementById(`achat-quantite${i}`).value) || 0;
                const prix = parseInt(document.getElementById(`achat-prix${i}`).value) || 0;
                const montant = parseInt(document.getElementById(`achat-montant${i}`).value) || 0;
                
                if (boisson && quantite > 0) {
                    hasItems = true;
                    achats.push({
                        date: dateStr,
                        fournisseur: fournisseur,
                        boisson: boisson,
                        quantite: quantite,
                        prix: prix,
                        montant: montant
                    });
                }
            }
            
            if (!hasItems) {
                alert("Veuillez ajouter au moins un article à l'achat");
                return;
            }
            
            // Générer le bon de commande
            generateCommande(dateStr, fournisseur);
            
            updateAchatsTable();
            alert('Achat enregistré avec succès!');
            
            // Réinitialiser le formulaire d'achat
            for (let i = 1; i <= currentAchatItems; i++) {
                document.getElementById(`achat-boisson${i}`).value = '';
                document.getElementById(`achat-quantite${i}`).value = '1';
                document.getElementById(`achat-prix${i}`).value = '';
                document.getElementById(`achat-montant${i}`).value = '';
            }
            document.getElementById('fournisseur').value = '';
        }
        
        function generateCommande(date, fournisseur) {
            const commandeItems = document.getElementById('commande-items');
            commandeItems.innerHTML = '';
            let total = 0;
            
            for (let i = 1; i <= currentAchatItems; i++) {
                const boisson = document.getElementById(`achat-boisson${i}`).value;
                const quantite = document.getElementById(`achat-quantite${i}`).value;
                const prix = document.getElementById(`achat-prix${i}`).value;
                const montant = document.getElementById(`achat-montant${i}`).value;
                
                if (boisson && quantite > 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${boisson}</td>
                        <td>${quantite}</td>
                        <td>${prix} FCFA</td>
                        <td>${montant} FCFA</td>
                    `;
                    commandeItems.appendChild(row);
                    total += parseInt(montant);
                }
            }
            
            document.getElementById('commande-total').textContent = `Total: ${total} FCFA`;
            document.getElementById('commande-date').textContent = `Date: ${date}`;
            document.getElementById('commande-fournisseur').textContent = fournisseur;
            
            document.getElementById('bon-commande').style.display = 'block';
        }
        
        // Fonctions pour la comptabilité
        function updateAchatsTable() {
            const table = document.getElementById('achats-table').getElementsByTagName('tbody')[0];
            table.innerHTML = '';
            
            let total = 0;
            
            achats.forEach(achat => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${achat.date}</td>
                    <td>${achat.fournisseur}</td>
                    <td>${achat.boisson}</td>
                    <td>${achat.quantite}</td>
                    <td>${achat.prix} FCFA</td>
                    <td>${achat.montant} FCFA</td>
                `;
                table.appendChild(row);
                total += achat.montant;
            });
            
            document.getElementById('achats-total').innerHTML = `
                <tr>
                    <th colspan="5">Total</th>
                    <th>${total} FCFA</th>
                </tr>
            `;
        }
        
        function updateVentesTable() {
            const table = document.getElementById('ventes-table').getElementsByTagName('tbody')[0];
            table.innerHTML = '';
            
            let total = 0;
            
            ventes.forEach(vente => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vente.date}</td>
                    <td>${vente.boisson}</td>
                    <td>${vente.quantite}</td>
                    <td>${vente.prix} FCFA</td>
                    <td>${vente.montant} FCFA</td>
                `;
                table.appendChild(row);
                total += vente.montant;
            });
            
            document.getElementById('ventes-total').innerHTML = `
                <tr>
                    <th colspan="4">Total</th>
                    <th>${total} FCFA</th>
                </tr>
            `;
        }
        
        function updateStock() {
            const table = document.getElementById('stock-table').getElementsByTagName('tbody')[0];
            table.innerHTML = '';
            
            // Calculer les quantités totales achetées et vendues par boisson
            const stock = {};
            
            achats.forEach(achat => {
                if (!stock[achat.boisson]) {
                    stock[achat.boisson] = { achat: 0, vente: 0 };
                }
                stock[achat.boisson].achat += achat.quantite;
            });
            
            ventes.forEach(vente => {
                if (!stock[vente.boisson]) {
                    stock[vente.boisson] = { achat: 0, vente: 0 };
                }
                stock[vente.boisson].vente += vente.quantite;
            });
            
            // Afficher les résultats
            for (const boisson in stock) {
                const row = document.createElement('tr');
                const restant = stock[boisson].achat - stock[boisson].vente;
                row.innerHTML = `
                    <td>${boisson}</td>
                    <td>${stock[boisson].achat}</td>
                    <td>${stock[boisson].vente}</td>
                    <td>${restant}</td>
                `;
                table.appendChild(row);
            }
        }
        
        function updateRevenue() {
            const month = parseInt(document.getElementById('month-select').value);
            const year = parseInt(document.getElementById('year-select').value);
            
            const table = document.getElementById('recette-table').getElementsByTagName('tbody')[0];
            table.innerHTML = '';
            
            let totalSales = 0;
            let totalPurchases = 0;
            const dailyData = {};
            
            // Regrouper les ventes par date
            ventes.forEach(vente => {
                const dateParts = vente.date.split('/');
                const venteDay = dateParts[0];
                const venteMonth = parseInt(dateParts[1]);
                const venteYear = parseInt(dateParts[2]);
                
                if (venteMonth === month && venteYear === year) {
                    const dateKey = vente.date;
                    if (!dailyData[dateKey]) {
                        dailyData[dateKey] = { sales: 0, purchases: 0 };
                    }
                    dailyData[dateKey].sales += vente.montant;
                    totalSales += vente.montant;
                }
            });
            
            // Regrouper les achats par date
            achats.forEach(achat => {
                const dateParts = achat.date.split('/');
                const achatDay = dateParts[0];
                const achatMonth = parseInt(dateParts[1]);
                const achatYear = parseInt(dateParts[2]);
                
                if (achatMonth === month && achatYear === year) {
                    const dateKey = achat.date;
                    if (!dailyData[dateKey]) {
                        dailyData[dateKey] = { sales: 0, purchases: 0 };
                    }
                    dailyData[dateKey].purchases += achat.montant;
                    totalPurchases += achat.montant;
                }
            });
            
            // Afficher les résultats
            for (const date in dailyData) {
                const revenue = dailyData[date].sales - dailyData[date].purchases;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${date}</td>
                    <td>${dailyData[date].sales} FCFA</td>
                    <td>${dailyData[date].purchases} FCFA</td>
                    <td>${revenue} FCFA</td>
                `;
                table.appendChild(row);
            }
            
            document.getElementById('monthly-sales').textContent = `${totalSales} FCFA`;
            document.getElementById('monthly-purchases').textContent = `${totalPurchases} FCFA`;
            document.getElementById('monthly-revenue').textContent = `${totalSales - totalPurchases} FCFA`;
        }
        
        // Fonctions d'impression et d'export
        function printInvoice() {
            updatePrintDateTime();
            window.print();
        }
        
        function printCommande() {
            updatePrintDateTime();
            window.print();
        }
        
        function printComptability(section) {
            const printSection = document.getElementById('comptability-print');
            const titleMap = {
                'achats': 'Journal des Achats',
                'ventes': 'Journal des Ventes',
                'stock': 'État du Stock',
                'recette': 'Recette Mensuelle'
            };
            
            document.getElementById('print-comptability-title').textContent = `L'ELEPHANT GROUMANT - ${titleMap[section]}`;
            
            const content = document.getElementById(`${section}-table`).cloneNode(true);
            content.classList.add('print-table');
            document.getElementById('print-comptability-content').innerHTML = '';
            document.getElementById('print-comptability-content').appendChild(content);
            
            updatePrintDateTime();
            
            // Afficher la section d'impression et masquer le reste
            const originalDisplay = printSection.style.display;
            printSection.style.display = 'block';
            
            window.print();
            
            // Restaurer l'affichage original
            printSection.style.display = originalDisplay;
        }
        
        function saveAsPDF() {
            // Dans une vraie application, vous utiliseriez une bibliothèque comme jsPDF
            // Voici une simulation qui permet d'enregistrer le HTML en tant que fichier
            const invoice = document.getElementById('invoice').cloneNode(true);
            const printDate = document.createElement('div');
            printDate.className = 'footer';
            printDate.innerHTML = `Document généré le ${formatDate(new Date())} à ${new Date().toLocaleTimeString()}`;
            invoice.appendChild(printDate);
            
            const html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Facture L'ELEPHANT GROUMANT</title>
                    <style>
                        body { font-family: Arial; padding: 20px; }
                        .invoice { width: 100%; }
                        .invoice-header { text-align: center; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
                        .total { font-weight: bold; text-align: right; margin-top: 20px; }
                        .footer { text-align: center; margin-top: 30px; font-size: 0.9em; color: #777; }
                    </style>
                </head>
                <body>
                    ${invoice.outerHTML}
                </body>
                </html>
            `;
            
            const blob = new Blob([html], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Facture_${document.getElementById('invoice-number').textContent}.pdf`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
        
        function saveCommandeAsPDF() {
            // Similaire à saveAsPDF mais pour le bon de commande
            alert("Fonctionnalité PDF à implémenter complètement avec jsPDF");
        }
        
        function exportComptability(section) {
            // Exporter les données au format CSV
            let csv = '';
            const table = document.getElementById(`${section}-table`);
            
            // Entêtes
            const headers = [];
            table.querySelectorAll('thead th').forEach(th => {
                headers.push(th.textContent);
            });
            csv += headers.join(';') + '\n';
            
            // Données
            table.querySelectorAll('tbody tr').forEach(tr => {
                const row = [];
                tr.querySelectorAll('td').forEach(td => {
                    row.push(td.textContent);
                });
                csv += row.join(';') + '\n';
            });
            
            // Pied de tableau si nécessaire
            if (section === 'achats' || section === 'ventes' || section === 'recette') {
                const footers = [];
                table.querySelectorAll('tfoot th').forEach(th => {
                    footers.push(th.textContent);
                });
                csv += footers.join(';') + '\n';
            }
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `L_ELEPHANT_GROUMANT_${section}_${formatDate(new Date())}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
        
        function updatePrintDateTime() {
            const now = new Date();
            document.getElementById('print-date').textContent = formatDate(now);
            document.getElementById('print-time').textContent = now.toLocaleTimeString();
        }
        
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Exemple de données initiales
            const now = new Date();
            const currentMonth = now.getMonth() + 1;
            const currentYear = now.getFullYear();
            
            document.getElementById('month-select').value = currentMonth;
            document.getElementById('year-select').value = currentYear;
            
            achats = [
                { date: '01/05/2025', fournisseur: 'Fournisseur A', boisson: 'Eau', quantite: 100, prix: 300, montant: 30000 },
                { date: '01/05/2025', fournisseur: 'Fournisseur A', boisson: 'Soda', quantite: 50, prix: 500, montant: 25000 },
                { date: '02/05/2025', fournisseur: 'Fournisseur B', boisson: 'Jus', quantite: 30, prix: 400, montant: 12000 },
                { date: '15/04/2025', fournisseur: 'Fournisseur C', boisson: 'Vin', quantite: 20, prix: 900, montant: 18000 }
            ];
            
            ventes = [
                { date: '03/05/2025', boisson: 'Eau', quantite: 20, prix: 500, montant: 10000 },
                { date: '03/05/2025', boisson: 'Soda', quantite: 10, prix: 700, montant: 7000 },
                { date: '04/05/2025', boisson: 'Jus', quantite: 5, prix: 600, montant: 3000 },
                { date: '20/04/2025', boisson: 'Vin', quantite: 3, prix: 1200, montant: 3600 }
            ];
            
            updateAchatsTable();
            updateVentesTable();
            updateStock();
            updateRevenue();
        });
    </script>
</body>
</html>